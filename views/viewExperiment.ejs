<!doctype html>
<html>
    <head>
        <title>View Experiment</title>
        <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
        <link href="/stylesheets/style.css" rel="stylesheet">
        <link href="/stylesheets/croppr.css" rel="stylesheet">
        <link href="/stylesheets/cropper.css" rel="stylesheet">
        <script data-auto-a11y="true" src="https://use.fontawesome.com/releases/v5.11.2/js/all.js"></script>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="/javascripts/viewexperiment.js"></script>
        <link href="/stylesheets/viewexperiment.css" rel="stylesheet">
        <script src="/javascripts/croppr.js"></script>
        <script src="/javascripts/cropper.js"></script>

        <style>
            #loadingPredict {
                position: fixed;
                width: 100%;
                height: 100vh;
                /* background: rgb(255, 255, 255, 0.5) url('/images/loading.gif') no-repeat center center; */
                background: #ffffff url('/images/loading.gif') no-repeat center center;
                z-index: 9999;
            }
            .backBtn {
                text-align: right;
            }
        </style>

    </head>

    <body>
        <!-- Display loading gif till the async call does not return a response -->
        <div id="loadingPredict" style="display: none"></div>

        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
            <button aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarNavDropdown" data-toggle="collapse" type="button">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="navbar-collapse collapse" id="navbarNavDropdown">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item" style="padding-top:5px;">
                        <a " href=" #" class=" btn btn-primary btn-sm">
                            <i class="fa fa-user"></i>
                            Welcome,
                            <%= uname %>!</a>
                    </li>
                    <li class="nav-item active home">
                        <a class="nav-link" href="/home">Home
                            <span class="sr-only">(current)</span>
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item logout">
                        <form action="/logout" id="form" method="POST">
                            <a class="nav-link" href="/logout" onclick="document.getElementById('form').submit(); return false;">Logout</a>
                        </form>
                    </li>
                </ul>
            </div>
        </nav>
        <br>
        <div
            class="container">
            <!-- 1st row buttons -->
            <div class="row divtop">
                <button class="btn btn-primary btnStyle" data-target="#addImageModal" data-toggle="modal" type="button">Add Images
                </button>

                <button class="btn btn-primary btnStyle" class="del_img_view" data-target="#deleteImageModal" data-toggle="modal" type="button">Delete Images
                </button>

                <a href="/Prevprediction/<%=id%>">
                    <button class="btn btn-primary btnStyle" id="previous_prediction " type="button">
                        Previous Prediction
                    </button>
                </a>

                <button class="btn btn-primary btnStyle" id="btnUnselectAll" type="button">
                    Unselect All
                </button>

                <button class="btn btn-primary btnStyle" id="btnSelectAll" type="button">Select All
                </button>

                <button class="btn btn-primary btnStyle" id="btnDisableCrop" type="button">Disable Selected Crop
                </button>

                <button class="btn btn-primary btnStyle" id="btnEnableCrop" type="button">Enable Selected Crop
                </button>

                <button class="btn btn-primary btnStyle" id="prediction" type="button">
                    Predict
                </button>

            </div>

            <!-- Display images -->
            <div
                class="row">

                <!-- Fetch images from the database -->
                <% for (let i = 0; i < data.length; i++) { %>

                    <!-- If images are already cropped, highlight the cropped portion -->
                    <% if (data[i].rect) { %>

                        <div class="col-md-3" style="margin: 30px 0 10px 0;">

                            <input class="checkboxImageTop" type="checkbox" name="cbIt<%= data[i].id %>" id="<%= data[i].id %>"/>

                            <div class="img-thumbnail">
                                <p style="float:right">
                                    <label class="switch">
                                        <input class="checkBoxToggleCrop" type="checkbox" value="<%= data[i].id %>" name="crop" id="cbToggle<%= data[i].id %>"/>
                                        <span class="slider round"></span>
                                    </label>
                                    <input class="btn btn-primary cropBtn promtSubmit" id='btnCrop<%= data[i].id %>' name="crop" type='button' value='Crop'/>
                                </p>
                                <p>
                                    <b>Image Id:
                                        <%= data[i].id %></b>
                                </p>
                                <div class="croppr-container object-fit_cover">
                                    <div class="croppr ">

                                        <img alt="null" class="large-image story-smallcroppr-image" src="/uploads/<%= data[i].exp_images %>" style="width: 279px; height: 223px;">

                                        <% for (let j = 0; j < data[i].rectArr.length; j++) { %>

                                            <img ; alt="null" class="croppr-imageClipped " src="/uploads/<%= data[i].exp_images %>" style="clip: <%= data[i].rectArr[j] %>;">
                                        <% } %>

                                        <div class="croppr-overlay"></div>
                                    </div>
                                </div>

                                <br>
                                <!-- <p style="float:right">
                                    <label class="switch">
                                        <input class="checkBoxToggleCrop" type="checkbox" value="<%= data[i].id %>" name="crop" id="cbToggle<%= data[i].id %>"/>
                                        <span class="slider round"></span>
                                    </label>
                                    <input class="btn btn-primary cropBtn promtSubmit" id='btnCrop<%= data[i].id %>' name="crop" type='button' value='Crop'/>
                                </p>
                                <p>
                                    <b>Image Id:
                                        <%= data[i].id %></b>
                                </p> -->
                            </div>
                        </div>

                    <% } else { %>

                        <div class="col-md-3">
                            <input class="checkboxImageTop" type="checkbox" name="cbIt<%= data[i].id %>" id="<%= data[i].id %>"/>
                            
                            <div class="img-thumbnail">
                                <p style="float:right">
                                    <label class="switch">
                                        <input class="checkBoxToggleCrop" type="checkbox" value="<%= data[i].id %>" name="crop" id="cbToggle<%= data[i].id %>"/>
                                        <span class="slider round"></span>
                                    </label>
                                    <input class="btn btn-primary cropBtn promtSubmit" id='btnCrop<%= data[i].id %>' name="crop" type='button' value='Crop'/>
                                </p>
                                <p>
                                    <b>Image Id:
                                        <%= data[i].id %></b>
                                </p>

                                <img class="large-image" src="/uploads/<%= data[i].exp_images %>"/>

                                <!-- <br>
                                <p style="float:right">
                                    <label class="switch">
                                        <input class="checkBoxToggleCrop" type="checkbox" value="<%= data[i].id %>" name="crop" id="cbToggle<%= data[i].id %>"/>
                                        <span class="slider round"></span>
                                    </label>
                                    <input class="btn btn-primary cropBtn promtSubmit" id='btnCrop<%= data[i].id %>' name="crop" type='button' value='Crop'/>
                                </p>
                                <p>
                                    <b>Image Id:
                                        <%= data[i].id %></b>
                                </p> -->
                            </div>
                        </div>

                    <% } %>
                <% } %>
            </div>
            <!-- <br>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <br> -->

            <!-- Add Image Modal -->

            <div aria-hidden="true" aria-labelledby="addImageModal" class="modal" id="addImageModal" role="dialog" role="dialog" tabindex="-1">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Add More Images</h5>
                            <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form class="form" method="POST" action="<%= data[0].exp_id %>" enctype="multipart/form-data">
                                <label for="expImage">Experiment Image</label>
                                <input accept="image/*" autofocus multiple name="expImage" required type="file"/>

                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                                <button class="btn btn-primary" type="submit">Add Images</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>


            <!-- Delete Image Modal -->
            <div aria-hidden="true" aria-labelledby="deleteImageModal" class="modal fade row divtop" id="deleteImageModal" role="dialog" tabindex="-1">

                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Delete Images</h5>
                            <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <div class="modal-body">
                            <p id="demo">
                                No Image Selected
                            </p>
                            <p id="demo1"></p>
                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                            <button class="btn btn-primary" id="deleteBtn" type="submit">Delete Images</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Attach Label Feature -- not using currently -->
            <div aria-hidden="true" aria-labelledby="cropPromtBoxModal" class="modal fade row divtop" id="cropPromtBox" role="dialog" tabindex="-1">

                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title">Add Label Name</h4>
                        </div>
                        <div class="modal-body">
                            <form action="" class="form" enctype="multipart/form-data" method="POST">
                                <div>
                                    <label for="labelName">
                                        Label Name
                                    </label><br>
                                    <input class="form-control" id="labelName" name="labelName" type="text" value="">
                                </div>
                                <br><br>
                                <button class="btn btn-primary btn-block promtSubmit" type="submit">
                                    Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </body>

</html>